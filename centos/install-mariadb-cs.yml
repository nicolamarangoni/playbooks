- hosts: '{{ host }}'
  tasks:
    - name: Install dependencies
      yum:
        state: latest
        name:
          - epel-release
          - wget
          - boost
          - expect
          - openssl
          - zlib
          - file
          - sudo
          - libaio
          - rsync
          - snappy
          - net-tools
          - MySQL-python
          - perl
          - perl-DBI
          - perl-DBD-MySQL
    - name: Download ColumnStore tar
      get_url:
        url: https://downloads.mariadb.com/ColumnStore/{{ version }}/centos/x86_64/7/mariadb-columnstore-{{ version }}-1-centos7.x86_64.rpm.tar.gz
        dest: '~'
    - name: Extract archive
      unarchive:
        src: ~/mariadb-columnstore-{{ version }}-1-centos7.x86_64.rpm.tar.gz
        dest: '~'
    - name: Install all ColumnStore packages
      command:
        - yum -y install ~/mariadb-columnstore-{{ version }}-1-x86_64-centos7-common.rpm
        - yum -y install ~/mariadb-columnstore-{{ version }}-1-x86_64-centos7-shared.rpm
        - yum -y install ~/mariadb-columnstore-{{ version }}-1-x86_64-centos7-client.rpm
        - yum -y install ~/mariadb-columnstore-{{ version }}-1-x86_64-centos7-server.rpm
        - yum -y install ~/mariadb-columnstore-{{ version }}-1-x86_64-centos7-libs.rpm
        - yum -y install ~/mariadb-columnstore-{{ version }}-1-x86_64-centos7-platform.rpm
        - yum -y install ~/mariadb-columnstore-{{ version }}-x86_64-centos7-gssapi-server.rpm
        - yum -y install ~/mariadb-columnstore-{{ version }}-1-x86_64-centos7-rocksdb-engine.rpm
        - yum -y install ~/mariadb-columnstore-{{ version }}-1-x86_64-centos7-storage-engine.rpm
        - yum -y install ~/mariadb-columnstore-{{ version }}-1-x86_64-centos7-tokudb-engine.rpm
    - name: Remove archive
      file:
        path: ~/mariadb-columnstore-{{ version }}-1-centos7.x86_64.rpm.tar.gz
        state: absent
